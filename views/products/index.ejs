<%- include('../partials/head')%>
<%- include('../partials/navbar') %>
<body>
    <div class="parallax"></div>
	<h1>Our Entire Store. At Your Fingertips.</h1>
	<div class="small-container">
        <%- include('../partials/flash') %>
        <div class="row row-2">
            <h2>All Products</h2>
            <form action="/products" method="GET">
              <select name="sort" onchange="this.form.submit()">
                <% switch(s){
              			case "last": -%>
                      <option value="default">Default Sorting</option>
                      <option value="last" selected>Last Updated</option>
                      <option value="priceHigh">Price: High to Low</option>
                      <option value="priceLow">Price: Low to High</option>
                    <%  break;
              			case "priceHigh": -%>
                      <option value="default">Default Sorting</option>
                      <option value="last">Last Updated</option>
                      <option value="priceHigh" selected>Price: High to Low</option>
                      <option value="priceLow">Price: Low to High</option>
                    <%  break;
              			case "priceLow": -%>
                      <option value="default">Default Sorting</option>
                      <option value="last">Last Updated</option>
                      <option value="priceHigh">Price: High to Low</option>
                      <option value="priceLow" selected>Price: Low to High</option>
                    <%  break;
                    default: -%>
                      <option value="default" selected>Default Sorting</option>
                      <option value="last">Last Updated</option>
                      <option value="priceHigh">Price: High to Low</option>
                      <option value="priceLow">Price: Low to High</option>
                    <%  break;
              	   } -%>
                </select>
            </form>
        </div>

        <% var sortedProducts;
          switch(s) {
          		case "last":
                sortedPoducts = sortResults('added', false); break;
          		case "priceHigh":
                sortedProducts = sortResults('price', false); break;
          	 	case "priceLow":
                sortedProducts = sortResults('price', true); break;
          	 	default:
                sortedProducts = allProducts; break;
           }
        %>
        <%- include('../partials/productTile', {products: sortedProducts}); %>


        <!-- Navigate the Products -->
				<!-- Should include the page btn stuff inside the row/col/idx logic-->
        <!-- <div class="page-btn" style="margin: auto;">
            <span style="margin: 0">1</span>
            <span>2</span>
            <span>3</span>
            <span>4</span>
            <span>â†’ </span>
        </div> -->
    </div>

    <%- include('../partials/footer') %>

    <script>
        function sortResults(prop, asc) {
          allProducts.sort(function(a, b){
              if (asc) {
                return (a[prop] > b[prop]) ? 1 : ((a[prop] < b[prop]) ? -1 : 0);
              } else {
                return (b[prop] > a[prop]) ? 1 : ((b[prop] < a[prop]) ? -1 : 0);
              }
          });
          renderResults();
        };

        var counter = Math.floor(Math.random() * 4);
        $(document).ready(function(){
            filePath = "url(/img/background" + counter + ".jpeg)";
		    $(".parallax").css({"background-image":filePath});
        });
    </script>

</body>
</html>
